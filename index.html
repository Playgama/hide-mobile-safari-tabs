<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover"
  />
  <title>Mobile Safari Tabs Hider Demo</title>
  <style>
    :root {
      color-scheme: light dark;
      --isl-vh: 1%;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      font-family: system-ui, sans-serif;
      background: canvas;
      color: canvastext;
    }

    html.is-locked,
    html.is-locked body {
      overflow: hidden;
      position: relative;
      height: 100dvh;
      overscroll-behavior: none;
    }

    .holder {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: min(calc(var(--isl-vh) * 100), 100%);
      overflow: hidden;
      z-index: 2147483646;
      display: none;
    }

    html.is-locked .holder {
      display: block;
    }

    .scroller {
      display: block;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      overscroll-behavior: none;
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
    }

    .scroller-inner {
      display: flex;
      justify-content: flex-start;
      align-items: stretch;
      flex-direction: column;
      height: calc(100% + 1px);
      min-height: calc(100% + 1px);
    }

    .content {
      display: flex;
      justify-content: flex-start;
      align-items: stretch;
      flex-direction: column;
      position: sticky;
      width: 100%;
      height: calc(100% - 1px);
      top: 0;
      bottom: 0;
    }

    .fullscreen-game {
      border-style: none;
      position: fixed;
      inset: 0;
      height: 100dvh;
      width: 100vw;
    }

    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 12px env(safe-area-inset-right) 0 env(safe-area-inset-left);
      z-index: 2147483647;
      pointer-events: none;
    }

    .overlay.is-visible {
      display: flex;
    }

    .bubble {
      max-width: 80vw;
      backdrop-filter: blur(8px);
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      border-radius: 96px;
      padding: 12px;
      font-size: 14px;
      pointer-events: auto;
    }

    .spacer {
      display: none;
      width: 1px;
      height: 2000vh;
    }

    .spacer.is-visible {
      display: block;
    }
  </style>
</head>
<body>
<iframe
  class="fullscreen-game"
  src="https://playgama.com/export/game/ad-testing"
>
</iframe>

<div class="holder">
  <div class="scroller">
    <div class="scroller-inner">
      <div class="content"></div>
    </div>
  </div>
</div>

<div class="overlay">
  <div class="bubble">
    Scroll down a bit to hide the browser bars and enjoy the full screen
  </div>
</div>

<div class="spacer"></div>

<script>
  const overlay = document.querySelector('.overlay');
  const spacer = document.querySelector('.spacer');
  const gameIframe = document.querySelector('.fullscreen-game');
  const islContent = document.querySelector('.content');

  let tabsOpen = false;
  let rafId = null;

  function measure() {
    if (rafId !== null) {
      cancelAnimationFrame(rafId);
    }

    rafId = requestAnimationFrame(() => {
      document.documentElement.style.setProperty('--isl-vh', (window.innerHeight * 0.01) + 'px');

      const screenShort = Math.min(window.screen.width, window.screen.height);
      const viewport = window.visualViewport;

      const MOBILE_CHROME_TOP_BAR_HEIGHT = 20; // In Chrome on iOS the top browser bar never fully hides
      const open = !!viewport && viewport.height + viewport.offsetTop < screenShort - MOBILE_CHROME_TOP_BAR_HEIGHT;

      if (open === tabsOpen) {
        return;
      }

      tabsOpen = open;

      window.setTimeout(() => {
        document.documentElement.classList.toggle('is-locked', !open);
        overlay.classList.toggle('is-visible', open);
        spacer.classList.toggle('is-visible', open);

        if (!open) {
          islContent.appendChild(gameIframe);
        } else {
          document.body.appendChild(gameIframe);
        }

        Object.assign(gameIframe.style, {
          position: open ? 'fixed' : 'relative',
          inset: open ? '0' : 'auto',
          height: open ? '100dvh' : '100%',
          width: open ? '100vw' : '100%',
        });
      }, open ? 0 : 100);
    });
  }

  function init() {
    if (!window.navigator.userAgent.match(/(iPhone|iPad|iPod)/)) {
      return;
    }

    measure();

    window.addEventListener('resize', measure, { passive: true });
    window.addEventListener('orientationchange', measure, { passive: true });
    window.addEventListener('scroll', measure, { passive: true });

    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', measure, { passive: true });
      window.visualViewport.addEventListener('scroll', measure, { passive: true });
    }
  }

  init();
</script>
</body>
</html>
